# Privacy Gateway - 需求文档

## 1. 项目概述

**项目名称:** Privacy Gateway (隐私网关)

**核心理念:** 一个轻量级、高性能、注重隐私保护的反向代理服务。它将传入的 HTTP 请求转发到指定的目标服务器，同时从请求头中过滤掉敏感的用户信息，以保护用户隐私。

**目标部署:** 应用程序必须打包成一个极简的 Docker 容器，以便于安全、通用地部署。

## 2. 核心功能 (MVP - 最小可行产品)

### 2.1. 反向代理引擎

- 服务应监听一个可配置的 HTTP 端口。
- 必须解析传入的请求 URL，以确定目标主机和其余路径。
- URL 结构为 `http://<代理地址>/<目标主机>/<目标路径>`。
- 必须将请求（包括方法、请求体和过滤后的头信息）转发到 `https://<目标主机>/<目标路径>`。
- 必须将目标服务器的响应（包括状态码、头信息和响应体）以流式方式传回给原始客户端。

### 2.2. 敏感头信息过滤

- 在转发请求之前，服务必须移除一个预定义列表中的敏感 HTTP 头信息。
- 过滤操作应不区分大小写。
- 要过滤的头信息列表必须是可配置的。

### 2.3. 配置管理

- 所有配置参数必须通过环境变量进行管理，以遵循十二要素应用（12-Factor App）原则。
- **必需配置项:**
    - `GATEWAY_PORT`: 网关监听的端口 (例如: `8080`)。
    - `SENSITIVE_HEADERS`: 一个逗号分隔的字符串，包含要过滤的头信息关键字 (例如: `'cf-,x-forwarded,proxy'`)。

### 2.4. 部署

- 项目必须包含一个 `Dockerfile`。
- `Dockerfile` 必须使用多阶段构建（multi-stage build）来生成一个极简的、生产就绪的镜像。
    - **构建阶段:** 使用标准的 Go 镜像来构建一个静态二进制文件。
    - **最终阶段:** 使用一个极简的基础镜像 (如 `alpine` 或 `distroless`)，并且只包含编译好的二进制文件。

## 3. 技术规格

- **开发语言:** Go (Golang)
- **关键库:**
    - `net/http`: 用于核心服务器和代理逻辑。
    - `os` 和 `strings`: 用于处理环境变量。
- **日志记录:**
    - 日志应采用结构化格式 (例如 JSON)。
    - 日志必须输出到标准输出 (`stdout`)，以便于被容器编排系统 (如 Docker, Kubernetes) 捕获。

## 4. 未来增强功能 (MVP 之后)

- **访问控制:** 要求使用 API 密钥或令牌才能使用代理。
- **速率限制:** 限制来自单个 IP 地址的请求频率。
- **自定义规则:** 允许更复杂的过滤规则，可能通过一个配置文件来实现。
- **指标与监控:** 通过 `/metrics` 端点暴露基本指标 (例如请求计数、处理时长)，以便于 Prometheus 集成。
