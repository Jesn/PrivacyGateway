# Privacy Gateway ç”¨æˆ·ä½¿ç”¨æŒ‡å—

## ç®€ä»‹

Privacy Gateway æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä»£ç†æœåŠ¡ï¼Œæä¾›å®‰å…¨çš„APIè®¿é—®æ§åˆ¶å’Œä»¤ç‰Œç®¡ç†åŠŸèƒ½ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹å¹¶å……åˆ†åˆ©ç”¨æ‰€æœ‰åŠŸèƒ½ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. è®¿é—®ç®¡ç†ç•Œé¢

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®æ‚¨çš„Privacy Gatewayç®¡ç†ç•Œé¢ï¼š
```
https://your-domain.com
```

### 2. ç®¡ç†å‘˜è®¤è¯

é¦–æ¬¡è®¿é—®éœ€è¦è¾“å…¥ç®¡ç†å‘˜å¯†é’¥ã€‚è¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜è·å–å¯†é’¥ã€‚

### 3. åˆ›å»ºç¬¬ä¸€ä¸ªä»£ç†é…ç½®

1. ç‚¹å‡»"æ·»åŠ é…ç½®"æŒ‰é’®
2. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   - **åç§°**: ç»™é…ç½®èµ·ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°
   - **å­åŸŸå**: ç”¨äºè®¿é—®çš„å­åŸŸåï¼ˆå¦‚ï¼šapiï¼‰
   - **ç›®æ ‡URL**: è¦ä»£ç†çš„ç›®æ ‡æœåŠ¡åœ°å€
   - **åè®®**: é€‰æ‹©HTTPæˆ–HTTPS
3. ç‚¹å‡»"ä¿å­˜"å®Œæˆåˆ›å»º

### 4. åˆ›å»ºè®¿é—®ä»¤ç‰Œ

1. åœ¨é…ç½®åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšåˆ›å»ºçš„é…ç½®
2. ç‚¹å‡»"ç®¡ç†ä»¤ç‰Œ"æŒ‰é’®
3. ç‚¹å‡»"åˆ›å»ºä»¤ç‰Œ"
4. å¡«å†™ä»¤ç‰Œä¿¡æ¯ï¼š
   - **åç§°**: ä»¤ç‰Œçš„åç§°
   - **æè¿°**: ä»¤ç‰Œçš„ç”¨é€”è¯´æ˜
   - **æƒé™**: é€‰æ‹©è¯»å–æˆ–è¯»å†™æƒé™
   - **è¿‡æœŸæ—¶é—´**: è®¾ç½®ä»¤ç‰Œçš„æœ‰æ•ˆæœŸ
5. ç‚¹å‡»"åˆ›å»º"å¹¶å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œ

âš ï¸ **é‡è¦**: ä»¤ç‰Œåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹å³å¤åˆ¶å¹¶å¦¥å–„ä¿å­˜ï¼

## åŠŸèƒ½è¯¦è§£

### ä»£ç†é…ç½®ç®¡ç†

#### åˆ›å»ºé…ç½®
- **åç§°**: é…ç½®çš„æ˜¾ç¤ºåç§°ï¼Œä¾¿äºè¯†åˆ«
- **å­åŸŸå**: ç”¨äºå­åŸŸåä»£ç†çš„å‰ç¼€ï¼Œå¦‚è®¾ç½®ä¸º"api"ï¼Œåˆ™å¯é€šè¿‡ `api.your-domain.com` è®¿é—®
- **ç›®æ ‡URL**: å®é™…è¦ä»£ç†çš„æœåŠ¡åœ°å€
- **åè®®**: ç›®æ ‡æœåŠ¡ä½¿ç”¨çš„åè®®
- **å¯ç”¨çŠ¶æ€**: æ§åˆ¶é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

#### ç¼–è¾‘é…ç½®
1. ç‚¹å‡»é…ç½®è¡Œçš„"ç¼–è¾‘"æŒ‰é’®
2. ä¿®æ”¹éœ€è¦æ›´æ”¹çš„å­—æ®µ
3. ç‚¹å‡»"ä¿å­˜"åº”ç”¨æ›´æ”¹

#### åˆ é™¤é…ç½®
1. ç‚¹å‡»é…ç½®è¡Œçš„"åˆ é™¤"æŒ‰é’®
2. ç¡®è®¤åˆ é™¤æ“ä½œ

âš ï¸ **æ³¨æ„**: åˆ é™¤é…ç½®ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰ç›¸å…³çš„è®¿é—®ä»¤ç‰Œï¼

### ä»¤ç‰Œç®¡ç†

#### ä»¤ç‰Œç±»å‹
- **è¯»å–ä»¤ç‰Œ**: åªèƒ½è¿›è¡ŒGETè¯·æ±‚
- **è¯»å†™ä»¤ç‰Œ**: å¯ä»¥è¿›è¡Œæ‰€æœ‰HTTPæ–¹æ³•çš„è¯·æ±‚

#### åˆ›å»ºä»¤ç‰Œ
1. åœ¨é…ç½®ç®¡ç†é¡µé¢ç‚¹å‡»"ç®¡ç†ä»¤ç‰Œ"
2. ç‚¹å‡»"åˆ›å»ºä»¤ç‰Œ"æŒ‰é’®
3. å¡«å†™ä»¤ç‰Œä¿¡æ¯
4. è®¾ç½®æƒé™å’Œè¿‡æœŸæ—¶é—´
5. ä¿å­˜å¹¶å¤åˆ¶ä»¤ç‰Œ

#### ç®¡ç†ä»¤ç‰Œ
- **æŸ¥çœ‹ä»¤ç‰Œ**: æŸ¥çœ‹ä»¤ç‰Œçš„è¯¦ç»†ä¿¡æ¯å’Œä½¿ç”¨ç»Ÿè®¡
- **ç¼–è¾‘ä»¤ç‰Œ**: ä¿®æ”¹ä»¤ç‰Œçš„åç§°ã€æè¿°ã€æƒé™ç­‰
- **ç¦ç”¨ä»¤ç‰Œ**: ä¸´æ—¶ç¦ç”¨ä»¤ç‰Œè€Œä¸åˆ é™¤
- **åˆ é™¤ä»¤ç‰Œ**: æ°¸ä¹…åˆ é™¤ä»¤ç‰Œ

#### ä»¤ç‰ŒçŠ¶æ€
- ğŸŸ¢ **æ´»è·ƒ**: ä»¤ç‰Œæ­£å¸¸å¯ç”¨
- ğŸŸ¡ **å³å°†è¿‡æœŸ**: ä»¤ç‰Œå°†åœ¨7å¤©å†…è¿‡æœŸ
- ğŸ”´ **å·²è¿‡æœŸ**: ä»¤ç‰Œå·²è¿‡æœŸï¼Œéœ€è¦æ›´æ–°
- âš« **å·²ç¦ç”¨**: ä»¤ç‰Œè¢«æ‰‹åŠ¨ç¦ç”¨

### ä½¿ç”¨ä»£ç†æœåŠ¡

#### æ–¹å¼ä¸€ï¼šç›´æ¥ä»£ç†
ä½¿ç”¨ `/proxy` ç«¯ç‚¹è¿›è¡Œä»£ç†è¯·æ±‚ï¼š

```bash
# ä½¿ç”¨HTTPå¤´éƒ¨ä¼ é€’ä»¤ç‰Œï¼ˆæ¨èï¼‰
curl -H "X-Proxy-Token: your-token" \
     "https://your-domain.com/proxy?target=https://api.example.com/users&config_id=config-uuid"

# ä½¿ç”¨æŸ¥è¯¢å‚æ•°ä¼ é€’ä»¤ç‰Œ
curl "https://your-domain.com/proxy?target=https://api.example.com/users&config_id=config-uuid&token=your-token"
```

#### æ–¹å¼äºŒï¼šå­åŸŸåä»£ç†
é€šè¿‡é…ç½®çš„å­åŸŸåç›´æ¥è®¿é—®ï¼š

```bash
# å¦‚æœé…ç½®çš„å­åŸŸåæ˜¯"api"
curl -H "X-Proxy-Token: your-token" \
     "https://api.your-domain.com/users"
```

#### æ–¹å¼ä¸‰ï¼šWebSocketä»£ç†
æ”¯æŒWebSocketè¿æ¥çš„ä»£ç†ï¼š

```javascript
const ws = new WebSocket('wss://your-domain.com/ws?target=wss://api.example.com/ws&config_id=config-uuid&token=your-token');
```

## æœ€ä½³å®è·µ

### å®‰å…¨å»ºè®®

1. **ä»¤ç‰Œç®¡ç†**
   - ä¸ºä¸åŒçš„åº”ç”¨æˆ–ç¯å¢ƒåˆ›å»ºç‹¬ç«‹çš„ä»¤ç‰Œ
   - å®šæœŸè½®æ¢ä»¤ç‰Œï¼Œç‰¹åˆ«æ˜¯é•¿æœŸä½¿ç”¨çš„ä»¤ç‰Œ
   - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ°¸ä¸è¿‡æœŸçš„ä»¤ç‰Œ
   - åŠæ—¶åˆ é™¤ä¸å†ä½¿ç”¨çš„ä»¤ç‰Œ

2. **æƒé™æ§åˆ¶**
   - éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„æƒé™
   - è¯»å–æ“ä½œä½¿ç”¨åªè¯»ä»¤ç‰Œ
   - å†™å…¥æ“ä½œä½¿ç”¨è¯»å†™ä»¤ç‰Œ

3. **ä»¤ç‰Œå­˜å‚¨**
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ä»¤ç‰Œ
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å®‰å…¨çš„é…ç½®ç®¡ç†ç³»ç»Ÿ
   - ä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•ä»¤ç‰Œä¿¡æ¯

### ç›‘æ§å’Œç»´æŠ¤

1. **ä½¿ç”¨ç»Ÿè®¡**
   - å®šæœŸæŸ¥çœ‹ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡
   - è¯†åˆ«å¼‚å¸¸çš„ä½¿ç”¨æ¨¡å¼
   - ç›‘æ§ä»¤ç‰Œçš„æ´»è·ƒåº¦

2. **æ—¥å¿—ç›‘æ§**
   - å…³æ³¨è®¤è¯å¤±è´¥çš„æ—¥å¿—
   - ç›‘æ§å¼‚å¸¸çš„è®¿é—®æ¨¡å¼
   - è®¾ç½®å‘Šè­¦æœºåˆ¶

3. **å®šæœŸå®¡æŸ¥**
   - å®šæœŸå®¡æŸ¥æ‰€æœ‰ä»¤ç‰Œçš„å¿…è¦æ€§
   - æ¸…ç†è¿‡æœŸå’Œæœªä½¿ç”¨çš„ä»¤ç‰Œ
   - æ›´æ–°ä»¤ç‰Œçš„æƒé™è®¾ç½®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è®¤è¯å¤±è´¥ (401é”™è¯¯)
**å¯èƒ½åŸå› **:
- ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ
- ä»¤ç‰Œè¢«ç¦ç”¨
- é…ç½®IDä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æ­£ç¡®å¤åˆ¶
- ç¡®è®¤ä»¤ç‰Œæœªè¿‡æœŸ
- éªŒè¯é…ç½®IDæ˜¯å¦æ­£ç¡®

#### 2. æƒé™ä¸è¶³ (403é”™è¯¯)
**å¯èƒ½åŸå› **:
- ä»¤ç‰Œæƒé™ä¸è¶³
- å°è¯•è®¿é—®æœªæˆæƒçš„èµ„æº

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ä»¤ç‰Œæƒé™è®¾ç½®
- ç¡®è®¤æ“ä½œç±»å‹æ˜¯å¦è¢«å…è®¸

#### 3. é…ç½®ä¸å­˜åœ¨ (404é”™è¯¯)
**å¯èƒ½åŸå› **:
- é…ç½®IDé”™è¯¯
- é…ç½®å·²è¢«åˆ é™¤

**è§£å†³æ–¹æ³•**:
- éªŒè¯é…ç½®ID
- æ£€æŸ¥é…ç½®æ˜¯å¦å­˜åœ¨

#### 4. ä»£ç†è¯·æ±‚å¤±è´¥
**å¯èƒ½åŸå› **:
- ç›®æ ‡æœåŠ¡ä¸å¯è¾¾
- ç½‘ç»œè¿æ¥é—®é¢˜
- ç›®æ ‡æœåŠ¡è¿”å›é”™è¯¯

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€
- éªŒè¯ç½‘ç»œè¿æ¥
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹å“åº”å¤´**
   ```bash
   curl -I -H "X-Proxy-Token: your-token" \
        "https://your-domain.com/proxy?target=https://api.example.com&config_id=config-uuid"
   ```

2. **å¯ç”¨è¯¦ç»†è¾“å‡º**
   ```bash
   curl -v -H "X-Proxy-Token: your-token" \
        "https://your-domain.com/proxy?target=https://api.example.com&config_id=config-uuid"
   ```

3. **æ£€æŸ¥ä»¤ç‰ŒçŠ¶æ€**
   - åœ¨ç®¡ç†ç•Œé¢æŸ¥çœ‹ä»¤ç‰Œçš„è¯¦ç»†ä¿¡æ¯
   - ç¡®è®¤ä»¤ç‰Œçš„çŠ¶æ€å’Œæƒé™

## é«˜çº§åŠŸèƒ½

### æ‰¹é‡æ“ä½œ

#### æ‰¹é‡åˆ›å»ºä»¤ç‰Œ
å¯ä»¥é€šè¿‡APIæ‰¹é‡åˆ›å»ºå¤šä¸ªä»¤ç‰Œï¼š

```bash
curl -X POST \
     -H "X-Log-Secret: admin-secret" \
     -H "Content-Type: application/json" \
     -d '{
       "tokens": [
         {"name": "Token 1", "permissions": ["read"]},
         {"name": "Token 2", "permissions": ["read", "write"]}
       ]
     }' \
     "https://your-domain.com/config/proxy/config-uuid/tokens/batch"
```

#### æ‰¹é‡æ›´æ–°ä»¤ç‰Œ
```bash
curl -X PUT \
     -H "X-Log-Secret: admin-secret" \
     -H "Content-Type: application/json" \
     -d '{
       "updates": [
         {"id": "token-1", "enabled": false},
         {"id": "token-2", "permissions": ["read"]}
       ]
     }' \
     "https://your-domain.com/config/proxy/config-uuid/tokens/batch"
```

### é…ç½®å¯¼å…¥å¯¼å‡º

#### å¯¼å‡ºé…ç½®
```bash
curl -H "X-Log-Secret: admin-secret" \
     "https://your-domain.com/config/proxy/export" > backup.json
```

#### å¯¼å…¥é…ç½®
```bash
curl -X POST \
     -H "X-Log-Secret: admin-secret" \
     -H "Content-Type: application/json" \
     -d @backup.json \
     "https://your-domain.com/config/proxy/import"
```

## æ”¯æŒå’Œå¸®åŠ©

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

1. æŸ¥çœ‹æœ¬ç”¨æˆ·æŒ‡å—çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. è”ç³»ç³»ç»Ÿç®¡ç†å‘˜è·å–æŠ€æœ¯æ”¯æŒ
4. æŸ¥çœ‹APIæ–‡æ¡£äº†è§£æ›´å¤šæŠ€æœ¯ç»†èŠ‚

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´8æœˆ29æ—¥
